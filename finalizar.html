<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <title>Finalizar Pedido</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Favicon -->
  <link rel="icon" href="IMG/Logo R&J.png" type="image/x-icon">
  <link rel="icon" href="IMG/Logo R&J.png" type="image/png">
  <link rel="icon" sizes="32x32" href="IMG/Logo R&J.png" type="image/png">
  <link rel="icon" sizes="48x48" href="IMG/Logo R&J.png" type="image/png">
  <link rel="apple-touch-icon" href="IMG/Logo R&J.png">

  <style>
    body {
      background: #610303;
      padding-top: 70px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #ffee07;
    }

    h1,
    h5 {
      color: #ffee07;
    }

    .list-group-item {
      background-color: #fff;
      color: #000;
      border-radius: 8px;
      margin-bottom: 10px;
      padding: 15px 20px;
    }

    .adicional-item {
      margin-left: 15px;
      font-size: 0.9rem;
    }

    #total {
      font-size: 1.3rem;
      font-weight: 700;
      margin-top: 20px;
      color: #ffee07;
    }

    #aviso-taxa-cartao {
      display: none;
      margin-top: 8px;
      padding: 10px;
      background-color: #fff3cd;
      border: 1px solid #ffeeba;
      color: #856404;
      border-radius: 5px;
      font-weight: 600;
    }

    .btn-voltar {
      background-color: #198754;
      border-color: #198754;
      color: #fff;
      font-weight: 600;
    }

    .btn-voltar:hover {
      background-color: #145c32;
      border-color: #145c32;
      color: #fff;
    }
  </style>
</head>

<body>

  <div class="container">
    <h1 class="mb-4">üì¶ Finalizar Pedido</h1>

    <h5>Resumo do Pedido:</h5>
    <ul id="resumo-carrinho" class="list-group mb-3"></ul>
    <p id="total">Total: R$ 0.00</p>

    <form id="form-pedido">
      <div class="mb-3">
        <label for="nome" class="form-label">Nome completo</label>
        <input type="text" class="form-control" id="nome" required />
      </div>
      <div class="mb-3">
        <label for="telefone" class="form-label">Telefone / WhatsApp</label>
        <input type="tel" class="form-control" id="telefone" required />
      </div>
      <div class="mb-3">
        <label for="endereco" class="form-label">Endere√ßo para entrega</label>
        <textarea class="form-control" id="endereco" rows="3" required></textarea>
      </div>
      <div class="mb-3">
        <label for="pagamento" class="form-label">Forma de pagamento</label>
        <select class="form-select" id="pagamento" required>
          <option value="" disabled selected>Selecione</option>
          <option value="dinheiro">Dinheiro</option>
          <option value="credito">Cart√£o de Cr√©dito</option>
          <option value="debito">Cart√£o de D√©bito</option>
          <option value="pix">PIX</option>
        </select>
        <div id="aviso-taxa-cartao">‚ö†Ô∏è Pagamento no cart√£o de cr√©dito tem taxa extra.</div>
      </div>
      <button type="submit" class="btn btn-success">‚úÖ Confirmar Pedido</button>
      <a href="pedidos.html" class="btn btn-secondary ms-2">‚Üê Voltar</a>
    </form>
  </div>

  <script>
    const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
    const resumo = document.getElementById('resumo-carrinho');
    const totalSpan = document.getElementById('total');
    const pagamentoSelect = document.getElementById('pagamento');
    const avisoTaxaCartao = document.getElementById('aviso-taxa-cartao');

    let total = 0;

    if (carrinho.length === 0) {
      resumo.innerHTML = '<li class="list-group-item">Carrinho vazio.</li>';
      totalSpan.textContent = "Total: R$ 0.00";
    } else {
      carrinho.forEach(item => {
        const adicionais = item.adicionais || [];
        const precoAdicionais = adicionais.reduce((acc, a) => acc + a.preco, 0);
        const quantidade = item.quantidade || 1;
        const precoUnitarioTotal = item.preco + precoAdicionais;
        const subtotal = precoUnitarioTotal * quantidade;
        total += subtotal;

        const li = document.createElement('li');
        li.className = 'list-group-item d-flex flex-column';

        let adicionaisHTML = '';
        if (adicionais.length > 0) {
          adicionaisHTML = adicionais.map(add => `<div class="adicional-item">+ ${add.nome} (R$ ${add.preco.toFixed(2)})</div>`).join('');
        }

        li.innerHTML = `
          <div><strong>${item.nome}</strong> x ${quantidade} - R$ ${item.preco.toFixed(2)} cada</div>
          ${adicionaisHTML}
          <div><strong>Subtotal: R$ ${subtotal.toFixed(2)}</strong></div>
        `;

        resumo.appendChild(li);
      });

      totalSpan.textContent = `Total: R$ ${total.toFixed(2)}`;
    }

    pagamentoSelect.addEventListener('change', () => {
      if (pagamentoSelect.value === 'credito') {
        avisoTaxaCartao.style.display = 'block';
      } else {
        avisoTaxaCartao.style.display = 'none';
      }
    });

    document.getElementById('form-pedido').addEventListener('submit', function (e) {
      e.preventDefault();

      const nome = document.getElementById('nome').value.trim();
      const telefone = document.getElementById('telefone').value.trim();
      const endereco = document.getElementById('endereco').value.trim();
      const pagamento = pagamentoSelect.value;

      if (!nome || !telefone || !endereco || !pagamento) {
        alert("Por favor, preencha todos os campos.");
        return;
      }

      // Montar mensagem para WhatsApp
      let mensagem = `*Novo Pedido Bella Massa*%0A`;
      mensagem += `*Nome:* ${nome}%0A`;
      mensagem += `*Telefone:* ${telefone}%0A`;
      mensagem += `*Endere√ßo:* ${endereco}%0A`;
      mensagem += `*Pagamento:* ${pagamento.charAt(0).toUpperCase() + pagamento.slice(1)}%0A`;
      mensagem += `%0A*Itens:*%0A`;

      carrinho.forEach(item => {
        const adicionais = item.adicionais || [];
        const qtd = item.quantidade || 1;
        const precoAdicionais = adicionais.reduce((acc, a) => acc + a.preco, 0);
        const precoUnitarioTotal = item.preco + precoAdicionais;
        const subtotal = precoUnitarioTotal * qtd;

        mensagem += `- ${item.nome} x${qtd} = R$ ${(item.preco * qtd).toFixed(2)}%0A`;
        if (adicionais.length > 0) {
          adicionais.forEach(add => {
            mensagem += `  + ${add.nome} (R$ ${add.preco.toFixed(2)})%0A`;
          });
        }
        mensagem += `  Subtotal com adicionais: R$ ${subtotal.toFixed(2)}%0A`;
      });

      mensagem += `%0A*Total:* R$ ${total.toFixed(2)}%0A`;
      mensagem += `%0APor favor, confirme o pedido. Obrigado! üçï`;

      // N√∫mero da pizzaria no formato internacional sem sinais
      const numeroWhatsapp = '5515991130743'; // <- Altere aqui!

      // Criar URL com mensagem codificada
      const urlWhatsApp = `https://wa.me/${numeroWhatsapp}?text=${mensagem}`;

      // Abrir WhatsApp Web / App
      window.open(urlWhatsApp, '_blank');

      // Limpa o carrinho e redireciona para a home
      localStorage.removeItem('carrinho');
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 1000);
    });
  </script>

</body>

</html>